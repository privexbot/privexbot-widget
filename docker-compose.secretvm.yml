# Docker Compose for Widget - SecretVM Production Environment
# Purpose: Self-hosted widget on SecretVM (fallback if CDN is not used)
# Usage: Deploy alongside backend on SecretVM
#
# NOTE: For production, prefer serving widget via CDN (CloudFront, Cloudflare, etc.)
# This compose is for self-hosted fallback or testing.
#
# Subdomain: widget.privexbot.com
# Network: Uses same Traefik network as backend

services:
  widget:
    build:
      context: .
      dockerfile: Dockerfile.secretvm
    container_name: privexbot-widget-secretvm
    networks:
      - traefik
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:80/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    labels:
      - traefik.enable=true
      - traefik.http.routers.widget.rule=Host(`widget.privexbot.com`)
      - traefik.http.routers.widget.entrypoints=websecure
      - traefik.http.routers.widget.tls=true
      - traefik.http.services.widget.loadbalancer.server.port=80
      - traefik.docker.network=traefik

networks:
  traefik:
    external: true
